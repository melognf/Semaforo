/* ===== Base visual ===== */
:root{
  --bg:#f4f4f4;
  --panel:#222;
  --card:#333;              /* fondo de MÁQUINAS */
  --card-transp:#0b3a5c;    /* fondo de TRANSPORTES (diferente y bien contrastado) */
  --ink:#fff;
  --muted:#cbd5e1;

  --verde:#11d817;
  --amarillo:#FFC107;
  --rojo:#c72216;

  --borde:#3d3d3d;
  --borde-transp:#0e4c79;
  --shadow:0 10px 24px rgba(0,0,0,.25);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;
}

header{
  background:var(--panel);
  padding:12px 16px;
  text-align:center;
  border-bottom:1px solid #111;
}
h1{margin:0; font-weight:700; font-size:clamp(18px,2.8vw,24px)}

.panel{
  padding:18px 16px 40px;
  max-width:1200px;
  margin:0 auto;
}

.grid{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 1rem;
}

/* ===== Card común ===== */
.card{
  border-radius:12px;
  box-shadow: var(--shadow);
  padding:14px;
  position:relative;
  text-align:center;
}
.card h3{
  margin:0 0 10px;
  font-size:18px;
  font-weight:700;
  color:#fff;
}

/* Diferencias de fondo y borde por tipo */
.card.maquina{
  background:var(--card);
  border:1px solid var(--borde);
}
.card.transporte{
  background:var(--card-transp);
  border:1px solid var(--borde-transp);
}

/* ===== Máquinas (luz circular) ===== */
.card.maquina .estado{
  width:90px; height:90px;
  border-radius:50%;
  margin:10px auto 8px;
  background:#666;                 /* se sobreescribe con verde/amarillo/rojo */
  border:2px solid #fff;           /* ✅ borde blanco */
  box-shadow: 0 0 0 2px #d9d9d9;   /* aro exterior gris claro opcional */
}
.card.maquina .estado.verde{ background:var(--verde) }
.card.maquina .estado.amarillo{ background:var(--amarillo); animation: parpadeoLento 2s infinite }
.card.maquina .estado.rojo{ background:var(--rojo); animation: parpadeoRapido .8s infinite }

@keyframes parpadeoLento{ 0%,100%{opacity:1} 50%{opacity:.35} }
@keyframes parpadeoRapido{ 0%,100%{opacity:1} 50%{opacity:.12} }

/* ===== Transportes (cinta/track) ===== */
.card.transporte .trayecto{
  height:24px;
  border-radius:999px;
  background:#0a2f49;        /* base más oscura para contraste */
  border:2px solid #0d4066;
  overflow:hidden;
  margin:10px 14px;
  position:relative;
}
.card.transporte .cinta{
  position:absolute; inset:0;
  background-color:#0a2f49;   /* se sobrescribe por estado */
}
.card.transporte .cinta::after{
  content:"";
  position:absolute; inset:0;
  background:
    repeating-linear-gradient(
      135deg,
      rgba(255,255,255,.32) 0 12px,
      rgba(255,255,255,.10) 12px 24px
    );
  background-size: 24px 24px;   /* período = 24px (loop perfecto) */
  background-position: 0 0;
  will-change: background-position, filter;
  pointer-events:none;
}

/* Estados del transporte */
.card.transporte .trayecto.verde .cinta{ background-color: var(--verde); }
.card.transporte .trayecto.verde .cinta::after{ animation: conveyor 0.75s linear infinite; }

.card.transporte .trayecto.amarillo .cinta{ background-color: var(--amarillo); }
.card.transporte .trayecto.amarillo .cinta::after{ animation: pulso 1.2s ease-in-out infinite; }

.card.transporte .trayecto.rojo .cinta{ background-color: var(--rojo); }
.card.transporte .trayecto.rojo .cinta::after{ animation: none; } /* parado */

/* Animaciones transporte */
@keyframes conveyor{
  from { background-position:   0 0; }
  to   { background-position: 24px 0; }  /* desplaza EXACTO 1 período */
}
@keyframes pulso{
  0%,100%{ filter:brightness(1) }
  50%    { filter:brightness(.65) }
}

/* Accesibilidad: reduce motion */
@media (prefers-reduced-motion: reduce){
  .card.transporte .cinta::after{ animation: none !important; }
}

/* ===== Mensaje + Cronómetro ===== */
.msg, .cron{
  margin-top:10px;
  font-size:.92rem;
  color:#ffffff;
}
.cron{
  background:#222;
  border:1px solid #444;
  border-radius:8px;
  padding:6px 8px;
  display:inline-block;
}

/* Ocultar completamente mensaje/cronómetro cuando están vacíos (evita el "punto negro") */
.msg:empty,
.cron:empty{
  max-height: 0 !important;
  padding: 0 !important;
  border: 0 !important;
  background: transparent !important;
  box-shadow: none !important;
  opacity: 0 !important;
  visibility: hidden !important;
  display: block;
}

/* ===== Botones ===== */
.botones{ margin-top:10px; }
.botones button{
  margin:4px;
  padding:10px 12px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:700;
  color:#fff;
}
button.verde-btn{ background:#31a335 }
button.amarillo-btn{ background:var(--amarillo); color:#111; }
button.rojo-btn{ background:#F44336 }
.botones button:disabled{
  opacity:.55; cursor:not-allowed; filter:grayscale(.15);
}

/* Utilitaria para ocultar el botón Amarillo en fallo */
.botones .oculto{ display:none !important; }

/* ===== Layout de tarjetas y centrado del indicador ===== */
.card.maquina,
.card.transporte{
  display: grid;
  grid-template-rows: auto 1fr auto auto; /* 1: título | 2: indicador | 3: botones | 4: msg/cron */
  row-gap: 10px;
  min-height: 240px;
}
.card.maquina .estado{
  grid-row: 2;
  justify-self: center;
  align-self: center;
  /* movimiento suave sin reflow */
  --lift: 0px;
  transform: translateY(var(--lift));
  transition: transform .38s cubic-bezier(.22,.61,.36,1);
}
.card.transporte .trayecto{
  grid-row: 2;
  width: 85%;
  margin: 0 auto;
  align-self: center;
  /* movimiento suave sin reflow */
  --lift: 0px;
  transform: translateY(var(--lift));
  transition: transform .38s cubic-bezier(.22,.61,.36,1);
}
.card.transporte .botones,
.card.transporte .msg,
.card.transporte .cron{
  justify-self: center;
}

/* Al mostrar controles (compact + show-controls) elevamos un toque el indicador */
.card.maquina.compact.show-controls .estado{ --lift: -16px; }
.card.transporte.compact.show-controls .trayecto{ --lift: -16px; }

/* ===== Aparición suave de controles en modo compacto (VERDE) ===== */
/* Estado oculto (sin saltos de layout) */
.card.compact .botones,
.card.compact .msg,
.card.compact .cron{
  max-height: 0;
  opacity: 0;
  transform: translateY(6px);
  overflow: clip;
  pointer-events: none;
  visibility: hidden; /* evita foco/tab mientras está oculto */
  transition:
    max-height .60s cubic-bezier(.22,.61,.36,1),
    opacity    .35s ease,
    transform  .35s ease,
    visibility 0s linear .35s; /* visible cuando terminó el fade */
}

/* Mostrar por clase (lo maneja JS/temporizador) */
.card.compact.show-controls .botones,
.card.compact.show-controls .msg,
.card.compact.show-controls .cron{
  max-height: 220px;          /* suficiente para botones + msg/cron */
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
  visibility: visible;
  transition:
    max-height .60s cubic-bezier(.22,.61,.36,1),
    opacity    .35s ease,
    transform  .35s ease,
    visibility 0s;
}

/* Mostrar por hover SOLO en desktop (evita "hover pegado" en móvil) */
@media (hover: hover) and (pointer: fine){
  .card.compact:hover .botones,
  .card.compact:hover .msg,
  .card.compact:hover .cron{
    max-height: 220px;
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
    visibility: visible;
    transition:
      max-height .60s cubic-bezier(.22,.61,.36,1),
      opacity    .35s ease,
      transform  .35s ease,
      visibility 0s;
  }
}

/* ===== Pequeñas mejoras responsivas ===== */
@media (max-width:420px){
  .card{ padding:12px }
  .card.maquina .estado{ width:78px; height:78px; border-width:5px }
  .card.transporte{ min-height: 220px; }
  .card.transporte .trayecto{ width: 90%; }
}

/* ===== Modo resumen móvil (sin scroll inicial) ===== */
@media (max-width: 600px){
  body.mobile-summary .panel { padding-top: 0; }
  body.mobile-summary #grid-linea{ display:none; }

  /* Contenedor del resumen */
  #summary-mobile{ display: none; }
  body.mobile-summary #summary-mobile{
    display: grid;
    justify-items: center;
    align-items: center;
    min-height: calc(100dvh - 56px);
    width: 100%;
    padding: 0;                  /* el padding lo aporta .panel */
  }

  .summary-card{
    background: var(--card-transp);
    border: 1px solid var(--borde-transp);
    border-radius: 14px;
    box-shadow: var(--shadow);
    padding: 16px;
    width: 100%;
    max-width: 540px;
    margin: 0 auto;
    color: #fff;
    text-align: center;
  }

  .summary-title{
    font-size: 18px; font-weight: 800; margin: 0 0 10px;
  }

  .summary-kpis{
    display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
    margin: 10px 0 6px;
  }
  .kpi{
    border-radius: 12px; padding: 8px 6px;
    background: #0a2f49; border:1px solid #0d4066;
  }
  .kpi .n{ font-size: clamp(16px, 5vw, 22px); font-weight: 800; line-height: 1; }
  .kpi.ok   .n{ color: var(--verde); }
  .kpi.warn .n{ color: #805d00; }
  .kpi.bad  .n{ color: #ff6b6b; }
  .kpi > div:last-child{
    font-size: 12px;
    line-height: 1.1;
    white-space: normal;
    word-break: keep-all;
    text-wrap: balance;
  }

  .summary-list{
    display:flex; flex-wrap:wrap; gap:6px; justify-content:center;
    margin-top: 6px;
  }
  .chip{
    font-size: 12px; padding:6px 10px; border-radius:999px;
    border:1px solid #334155; background:#1f2937; color:#e2e8f0;
  }
  .chip.warn{ border-color:#a16207; background:#3b2d04; color:#ffd166; }
  .chip.bad { border-color:#7f1d1d; background:#3a0d0d; color:#fecaca; }

  .summary-footer{
    margin-top: 10px; font-size: 12px; color: #cbd5e1;
  }

  /* Por si alguna regla previa provocó overflow horizontal */
  .panel{ overflow-x: hidden; }
}

/* Ultra angosto: 2 columnas para que no se desborde “Advertencia” */
@media (max-width: 360px){
  .summary-kpis{ grid-template-columns: repeat(2, 1fr); }
}

/* Ocultar SIEMPRE el resumen por defecto (todas las pantallas) */
#summary-mobile{ display: none; }

/* Mostrar el resumen SOLO en móvil cuando hay body.mobile-summary */
@media (max-width: 600px){
  body.mobile-summary #summary-mobile{ display: grid; }
}

/* Ocultar el botón "Reportar fallo / advertencia" en desktop */
@media (hover: hover) and (pointer: fine){
  #summary-mobile .summary-actions{ display: none; }
}
